<!DOCTYPE html>
<html>
  <head>
    <title>What can we learn from spotting a Prius or two? – Silas B. Tittes – Adventures in genomics, evolutionary biology, and data science</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="If you live in a wealthy, liberal town like Boulder, CO, you’ve likely seen your fair share of Toyota Prii (this is supposedly the plural of Prius). Heck, you might even own one. I decided to collect a little data. I used my iPhone stopwatch to record wait times between seeing Prii. I walked at a near-constant speed, along a more or less linear transect along 13th Street, from Arapahoe to Spruce. I recorded for 10 minutes, hitting the “lap” button each time I saw a Prius (any year, parked or driving). There is some risk of counting one vehicle multiple times, but because I walked in one direction and only recorded for 10 minutes, I assume the risk is relatively low (unless Prius owners love driving so much, they just go out and do laps around city blocks – quite possible).

" />
    <meta property="og:description" content="If you live in a wealthy, liberal town like Boulder, CO, you’ve likely seen your fair share of Toyota Prii (this is supposedly the plural of Prius). Heck, you might even own one. I decided to collect a little data. I used my iPhone stopwatch to record wait times between seeing Prii. I walked at a near-constant speed, along a more or less linear transect along 13th Street, from Arapahoe to Spruce. I recorded for 10 minutes, hitting the “lap” button each time I saw a Prius (any year, parked or driving). There is some risk of counting one vehicle multiple times, but because I walked in one direction and only recorded for 10 minutes, I assume the risk is relatively low (unless Prius owners love driving so much, they just go out and do laps around city blocks – quite possible).

" />
    
    <meta name="author" content="Silas B. Tittes" />

    
    <meta property="og:title" content="What can we learn from spotting a Prius or two?" />
    <meta property="twitter:title" content="What can we learn from spotting a Prius or two?" />
    


    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Silas B. Tittes - Adventures in genomics, evolutionary biology, and data science" href="/feed.xml" />

    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://raw.githubusercontent.com/silastittes/silastittes.github.io/master/images/sims_plot.jpeg" /></a>	
	  
	  <div class="site-info">
            <h1 class="site-name"><a href="/">Silas B. Tittes</a></h1>
            <p class="site-description">Adventures in genomics, evolutionary biology, and data science</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <h1>What can we learn from spotting a Prius or two?</h1>

  <div class="entry">
    <p>If you live in a wealthy, liberal town like Boulder, CO, you’ve likely seen your fair share of Toyota Prii (this is supposedly the plural of Prius). Heck, you might even own one. I decided to collect a little data. I used my iPhone stopwatch to record wait times between seeing Prii. I walked at a near-constant speed, along a more or less linear transect along 13th Street, from Arapahoe to Spruce. I recorded for 10 minutes, hitting the “lap” button each time I saw a Prius (any year, parked or driving). There is some risk of counting one vehicle multiple times, but because I walked in one direction and only recorded for 10 minutes, I assume the risk is relatively low (unless Prius owners love driving so much, they just go out and do laps around city blocks – quite possible).</p>

<p>Below is some code I’ve thrown together to analyze the data I collected. The objective here is to predict the expected wait times between Prius sightings, and to quantify uncertainty in this expectation. Along the way, we’ll check out the max time you should expect to wait, and test a few assumptions of the model.</p>

<p>Load the relevant libraries:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">))</span><span class="w">
</span><span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">))</span><span class="w">
</span><span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">lubridate</span><span class="p">))</span><span class="w">
</span><span class="n">suppressMessages</span><span class="p">(</span><span class="n">library</span><span class="p">(</span><span class="n">rstan</span><span class="p">))</span><span class="w">
</span><span class="n">rstan_options</span><span class="p">(</span><span class="n">auto_write</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">options</span><span class="p">(</span><span class="n">mc.cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parallel</span><span class="o">::</span><span class="n">detectCores</span><span class="p">())</span><span class="w">
</span></code></pre>
</div>

<p>Load the data (lubridate package to convert weird minute-seconds to numeric integers).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">wt_times</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"00:11"</span><span class="p">,</span><span class="w"> </span><span class="s2">"01:08"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:06"</span><span class="p">,</span><span class="w"> </span><span class="s2">"02:06"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:06"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:16"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"00:00"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:06"</span><span class="p">,</span><span class="w"> </span><span class="s2">"01:43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:13"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:05"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:13"</span><span class="p">,</span><span class="w">
              </span><span class="s2">"01:59"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:45"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:27"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:51"</span><span class="p">,</span><span class="w"> </span><span class="s2">"00:02"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ms</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">as.numeric</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">data_frame</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">set_colnames</span><span class="p">(</span><span class="s2">"wait"</span><span class="p">)</span><span class="w">

</span><span class="n">n_obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>First observation: I saw 17 Prii in 10 minutes – that strikes me as a lot! I make no attempt to calculate the total number of Prii in Boulder from these observations, but that seems like a possible feat with some effort.</p>

<p>Let’s take a look at the distribution (it took some time, but I’m pretty solidly parked in <code class="highlighter-rouge">ggplot2</code> train these days).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">wt_times</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wait</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_bin</span><span class="p">(</span><span class="n">binwidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w">
                 </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Seconds between Prius sightings (Boulder, CO)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" style="display: block; margin: auto;" />
Figure 1. Sampled distribution of wait times.</p>

<p>Based on the graph and similarity to other problems, it seems reasonable to assume wait times are exponentially distributed. I’ll also assume that the observations are dictated by a single rate parameter (easy to imagine density of Prii vary across neighborhoods, which would violate this assumption).</p>

<p>To be totally overkill, I’m going to fit the model using Stan, to numerically approximate the posterior distribution of the exponential rate parameter. I’m pretty sure there’s an analytic solution for the posterior in this case (gamma distributed conjugacy?), but I’m just gonna do the Stan thing, since it generalizes well to more complex problems, and because I’m still pretty bad at real math.</p>

<p>Usually I’d write the Stan code in a separate file because it makes life easier, but I’ll write it directly into this post as a string to keep the post self-contained. I’m using a gamma prior for the exponential rate parameter, and I’m putting the shape and scale parameters as input to the Stan model to make assessment of prior sensitivity easier.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stan_string</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"

  data{
    int&lt;lower = 0&gt; N;
    real&lt;lower = 0&gt; y[N];
    real&lt;lower = 0&gt; pr_shape;
    real&lt;lower = 0&gt; pr_scale;
  }

  parameters{
    real&lt;lower = 0&gt; beta; 
  }

  model{
    beta ~ gamma(pr_shape, pr_scale);
    target += exponential_lpdf(y | beta);
  }
"</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stan_exp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stan_model</span><span class="p">(</span><span class="n">model_code</span><span class="o">=</span><span class="n">stan_string</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Stan parameterizes the exponential distribution using the rate, so a prior distribution that is concentrated near zero informs the model that wait times are long. This post was motivated by a belief that wait time between Prius spottings is small, so I’ll use a scale parameter that communicates this. Let’s keep things pushed toward zero (decay shape) with shape equal to one, and a large scale parameter to make for a long tail. I’m spit-balling here, but it seems like seeing a Prius every minute would be reasonable, so we’ll make both shape and scale equal to one. Choices about the prior should be made before looking at the data, but we can see how sensitive our inferences our to changing the prior (I don’t report the results in the blog, but the model doesn’t seem very sensitive to the prior, even with only 17 observations).</p>

<p>Here’s what this prior looks like.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">xseq</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">xseq</span><span class="p">,</span><span class="w"> </span><span class="n">dgamma</span><span class="p">(</span><span class="n">xseq</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"l"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Rate parameter"</span><span class="p">,</span><span class="w">
     </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Density"</span><span class="p">,</span><span class="w">
     </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-7-1.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" style="display: block; margin: auto;" />
Figure 2. Gamma prior for exponential rate parameter.</p>

<p>Bundle the data and run Stan.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">stan_in</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">,</span><span class="w">
  </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_obs</span><span class="p">,</span><span class="w">
  </span><span class="n">pr_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
  </span><span class="n">pr_scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">stan_fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sampling</span><span class="p">(</span><span class="w">
  </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stan_exp</span><span class="p">,</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stan_in</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">print</span><span class="p">(</span><span class="n">stan_fit</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Inference for Stan model: 45ee75e197adc87a0c44d348f2d7068b.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##        mean se_mean   sd   2.5%    25%    50%    75%  97.5% n_eff Rhat
## beta   0.03    0.00 0.01   0.02   0.02   0.03   0.03   0.04  1244    1
## lp__ -82.16    0.02 0.74 -84.31 -82.30 -81.86 -81.70 -81.65  1497    1
## 
## Samples were drawn using NUTS(diag_e) at Thu Aug 31 13:46:46 2017.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">traceplot</span><span class="p">(</span><span class="n">stan_fit</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-8-1.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" style="display: block; margin: auto;" />
Figure 3. Traceplot looks nice and grassy.</p>

<p>This is a tiny model that runs quite quickly. The default of 4000 iterations and 50% warm up is probably more than necessary, but the number of effective samples is good, as are the rhat values being 1. The traceplot looks nice and grassy, without any indications the chains are getting stuck on parameter values. The model returns a few warnings about boundaries, but this is not a concern (as the message itself says).</p>

<p>Next we can use the posterior draws to make inferences about the data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">#extract posterior draws from model
</span><span class="n">exp_post</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">stan_fit</span><span class="p">)</span><span class="w">

</span><span class="c1">#visualize posterior, but 1/rate, to see expected wait time scale
</span><span class="n">exp_post</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">beta</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_density</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Expected wait time"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-9-1.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" style="display: block; margin: auto;" />
Figure 4. Inferred posterior distribution for exponential rate parameter.</p>

<p>Compute credible interval of expected wait time</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">cred1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">exp_post</span><span class="o">$</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">))</span><span class="w">
</span><span class="n">cred1</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##     2.5%    97.5% 
## 22.62336 58.81163
</code></pre>
</div>

<p>So there’s a 95% chance the expected wait time between Prius spottings is between 23 and 59 seconds.</p>

<p>We can also easily see the probability that the expected wait time is less than, say, one minute.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="m">1</span><span class="o">/</span><span class="n">exp_post</span><span class="o">$</span><span class="n">beta</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">60</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.97925
</code></pre>
</div>

<p>Also valuable in a Bayesian framework is the ability to conduct posterior predictive checks. We can use posterior draws of the rate parameter, and generate simulated data from this exponential distribution. Perhaps the wait times have more variation than the exponential distribution allows for. We simply need to compare the observed variation to that of the simulated data sets:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">post_pred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">exp_post</span><span class="o">$</span><span class="n">beta</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">rexp</span><span class="p">(</span><span class="n">n_obs</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.x</span><span class="p">))</span><span class="w">
</span><span class="n">pred_var</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">post_pred</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="o">~</span><span class="n">var</span><span class="p">(</span><span class="n">.x</span><span class="p">))</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_var</span><span class="p">,</span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Posterior predictive variance"</span><span class="p">,</span><span class="w">
     </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-12-1.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" style="display: block; margin: auto;" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">mean</span><span class="p">(</span><span class="n">pred_var</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">var</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.24225
</code></pre>
</div>
<p>Figure 5. Distribution of variances from posterior predictive distributions, green line is the sample variance.</p>

<p>There’s a ~0.24% probability of simulated data having variation greater than the observed. This isn’t too far off. The nearer to 50%, the more consistent the simulated data and observed. The exponential distribution model as-is seems fairly adequate.</p>

<p>We can also get some idea of the max wait time conditional of the data.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">pred_max</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">post_pred</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map_dbl</span><span class="p">(</span><span class="o">~</span><span class="nf">max</span><span class="p">(</span><span class="n">.x</span><span class="p">))</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">pred_max</span><span class="p">,</span><span class="w"> 
     </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
     </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Posterior predictive maximum waits"</span><span class="p">,</span><span class="w">
     </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-13-1.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" style="display: block; margin: auto;" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">quantile</span><span class="p">(</span><span class="n">pred_max</span><span class="o">/</span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##     2.5%    97.5% 
## 0.841396 4.425619
</code></pre>
</div>

<p>Figure 6. Distribution of maximum wait times from posterior predictive distributions, green line is the sample maximum wait time.</p>

<p>Wow, the model predicts wait times should pretty much always be less than five minutes. That’s a lot of Prii flashing past your face!</p>

<p>We can also visually assess the simulated and observed distribution shapes by constructing quantile-quantile plots. I find it a bit easier to see departures by looking at the observed quantiles versus the difference in observed and simulated quantiles:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">prbs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n_obs</span><span class="p">)</span><span class="w">
</span><span class="n">obs_quants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">,</span><span class="w"> </span><span class="n">prbs</span><span class="p">)</span><span class="w">

</span><span class="n">lev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0.95</span><span class="w">
</span><span class="n">up</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lev</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="w">
</span><span class="n">lo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lev</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="w">

</span><span class="n">pred_quants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">post_pred</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="p">{</span><span class="n">quantile</span><span class="p">(</span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">prbs</span><span class="p">)</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">do.call</span><span class="p">(</span><span class="n">cbind</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">data.frame</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"draw"</span><span class="p">,</span><span class="w"> </span><span class="s2">"quants"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">obs_quants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_quants</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">obs_quants</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">upper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">quants</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">),</span><span class="w">
            </span><span class="n">lower</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">quants</span><span class="p">,</span><span class="w"> </span><span class="n">lo</span><span class="p">)</span><span class="w">
            </span><span class="p">)</span><span class="w">

</span><span class="c1">#gross, but not sure how else to compile this for polygon
</span><span class="n">pred_poly</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">  </span><span class="n">data.frame</span><span class="p">(</span><span class="w">
  </span><span class="n">obs_quants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">pred_quants</span><span class="o">$</span><span class="n">obs_quants</span><span class="p">,</span><span class="w"> 
                 </span><span class="n">rev</span><span class="p">(</span><span class="n">pred_quants</span><span class="o">$</span><span class="n">obs_quants</span><span class="p">)),</span><span class="w">
  </span><span class="n">pred_quants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">pred_quants</span><span class="o">$</span><span class="n">upper</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pred_quants</span><span class="o">$</span><span class="n">obs_quants</span><span class="p">,</span><span class="w"> 
                  </span><span class="n">rev</span><span class="p">(</span><span class="n">pred_quants</span><span class="o">$</span><span class="n">lower</span><span class="o">-</span><span class="n">pred_quants</span><span class="o">$</span><span class="n">obs_quants</span><span class="p">))</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span><span class="n">pred_poly</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obs_quants</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred_quants</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Simulated - observed quantiles"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Observed quantiles"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-14-1.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" style="display: block; margin: auto;" />
 Figure 7. 95% credible interval for difference between posterior predictive quantiles and sample quantiles for Prius sighting wait times.</p>

<p>Ideally, the shape should be relatively flat (exponential mean scales with variance, so heteroskedasticity is fine) and centered on zero. Overall this looks pretty good. The replicated draws to encapsulate zero. We confirm the exponential model isn’t too bad.</p>

<p>Another approach would have been to bootstrap the observations. <code class="highlighter-rouge">tidverse</code> makes this extra easy.
Let’s see how the approximate confidence interval for the expected wait time from the bootstrap compares to the credible interval.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">#10,000 bs reps
</span><span class="n">boots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">1e4</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_dbl</span><span class="p">(</span><span class="o">~</span><span class="p">{</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">sample</span><span class="p">(</span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mean</span><span class="p">})</span><span class="w">

</span><span class="n">hist</span><span class="p">(</span><span class="n">boots</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">wt_times</span><span class="o">$</span><span class="n">wait</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-15-1.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" style="display: block; margin: auto;" />
Figure 8. Distribution of bootstrap replicates for mean exponential wait times. Green line is sample mean (what’s up with me and green today?).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qnts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span><span class="n">quantile</span><span class="p">(</span><span class="n">boots</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##     2.5%    97.5% 
## 18.05882 57.00147
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qqplot</span><span class="p">(</span><span class="n">boots</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">/</span><span class="n">exp_post</span><span class="o">$</span><span class="n">beta</span><span class="p">,</span><span class="w"> 
       </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Bootstrap quantiles"</span><span class="p">,</span><span class="w">
       </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Bayesian quantiles"</span><span class="p">,</span><span class="w"> 
       </span><span class="n">cex.axis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">,</span><span class="w"> </span><span class="n">cex.lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.25</span><span class="p">)</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"green"</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/figure/source/2017-08-30-Prius/unnamed-chunk-16-1.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" style="display: block; margin: auto;" /></p>

<p>Figure 9. Bootstrap quantiles compared to posterior predictive quantiles. 1 to 1 line in green.</p>

<p>The intervals and qqplot both indicate similar predictions, the credible interval reported above is slightly narrower.</p>

<p>If the exponential distribution is a bad model to explain the wait times, it’s difficult to tell with so few observations. Conditional on the data at hand, the exponential seems to be a good assumption. Another worthwhile predictive check would be to assess if the observations are independent of each other and consistent over time/space. Ideally, the behavior of the sampling in the data would be consistent with what an exponential distribution would produce (exchangable observations). I believe this would require some sort of quntification of autocorrelation. I will hold off on doing any of that.</p>

<p>Probably could have stopped at the summary statistics, but either way the takehome is clear: you don’t have to wait around long before seeing a Prius in Boulder.</p>

<p>Would love to hear your thoughts on the post, any and all comments and critiques are welcome.</p>

  </div>

  <div class="date">
    Written on August 30, 2017
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'silastittes';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>



    </div>

    <div class="wrapper-footer">
	    <div class="container">
			  <footer class="footer">
			  <center><dev align="center"><a href="https://scholar.google.com/citations?user=LxGAurUAAAAJ&hl=en"><img border="0" alt="Google Scholar" src="https://raw.githubusercontent.com/silastittes/silastittes.github.io/master/images/google_scholar_wCap.png" width="150" height="200"></a><a href="https://www.inaturalist.org/projects/the-sunflower-community-project"><img border="0" alt="iNaturalist" src="https://raw.githubusercontent.com/silastittes/silastittes.github.io/master/images/Nat_bird.png" width="251" height="200"><a href="http://nkane.weebly.com/"><img border="0" alt="Kane lab" src="https://raw.githubusercontent.com/silastittes/silastittes.github.io/master/images/kane_lab.png" width="215" height="215"></a></a></dev></center>
			  </footer>
		  </div>
	  </div>
<!--
    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:silas.tittes@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/silastittes"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/SilasTittes"><i class="svg-icon twitter"></i></a>



        </footer>
      </div>
    </div>
-->
    



  </body>
</html>

<h2 id="whats-a-probability-plot">What’s a probability plot?</h2>
<p>I was introduced to quantile-quantile plots (aka q-q plots, which are very similar or even the same as probability plots) as an undergrad in a course called, Biometry. Famous to CU Boulder’s EBIO students, Biometry has been taught for many years (decades even?) by the most excellent, Doktor Michael Grant (aka, Hey You). The course introduced me to the use of quantile-quantile plots for testing the assumption of normally distributed residuals when fitting your standard, everyday pair of blue jeans, linear model. R has a nice function called qqnorm that does all the work for you. Here’s a brief demo:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">##################
# set up a model #
##################
</span><span class="n">n.size</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">100</span><span class="w">
</span><span class="n">x.dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">n.size</span><span class="w"> </span><span class="c1"># a fake explanatory variable 
</span><span class="n">err</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n.size</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="c1">#normally distributed error
</span><span class="n">y.dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x.dat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="w"> </span><span class="c1"># a fake predictor variable with error
</span><span class="n">model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">y.dat</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">x.dat</span><span class="p">)</span><span class="w"> </span><span class="c1"># fit linear model
</span><span class="n">plot</span><span class="p">(</span><span class="n">x.dat</span><span class="p">,</span><span class="w"> </span><span class="n">y.dat</span><span class="p">)</span><span class="w"> </span><span class="c1">#plot 
</span><span class="n">mod.coef</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">coef</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="c1">#store parameter estimates
</span><span class="n">curve</span><span class="p">(</span><span class="w"> </span><span class="n">mod.coef</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mod.coef</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w"> </span><span class="c1">#leave your abline at home
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1">##################
## the q-q plot ##
##################
</span><span class="n">qqnorm</span><span class="p">(</span><span class="w"> </span><span class="n">scale</span><span class="p">(</span><span class="n">resid</span><span class="p">(</span><span class="n">model</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="c1">#scale = values / standard deviation (values)
</span><span class="n">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="c1">#there's abline, are you happy now?
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-1-2.png" alt="plot of chunk unnamed-chunk-1" /></p>

<p>The basic idea is that if have an assumption about how your values of interest are distributed, you can visualize (and even quantify) how well that assumption is met by comparing the ranked (and sometimes scaled) values to the quantiles of the distribution you believe the values were drawn from. If there is a near one-to-one correspondence between the two, you’re in the clear. It’s also a good way to see how well a transform corrects for skew, heteroscedasticity, and the likes. By the way, quantile is a fancy word that more or less means a set a values that break a cumulative distribution into regular intervals (i.e. quantiles are the values that break off the first 10%, 20%, 30%, …, 90% of the density of a distribution). Naturally, distributions have their densities distributed differently over the set of values for which they are defined, so they will have different quantiles that regularly break their densities.</p>

<p>While a cool idea, I’ve always been a little dissatisfied with the q-q plot. How can an assumption check of a statistical test be so, un-statistical? Perhaps one argument is, if you can test the validity of a test, why not test the validity of the test you used to validate the original test of interest? Like an infinite mirror illusion, we could keep doing tests until the resolution of the reflection became too faint or too far into the margins of our vantage point. Sounds like a waste of time. Nonetheless, the assumption check could be a little more satisfying, and what better way to satisfy than using simulations?!</p>

<p>To add to the probability plot, lets compare the quantiles of a distribution to many random draws from that distribution, and then see if and how our values of interest depart from the overall patterns we observe in the plot. This is a quick way to better understand the expected degree of random departures in a way that can’t be captured using the R’s standard qqnorm function.</p>

<p>Working with probability distributions is made ridiculously easy in R. For example, if you want 100 draws from a normal distribution with a mean of 10 and a standard deviation of 5, simple type, “rnorm(100, 10, 5)”. Bam. For every distribution native to R, there are 4 utilities: d, r, p, q. - density, random, probability, and quantile. We will concern ourselves with the random and quantile utilities.</p>

<h2 id="enough-english-lets-take-a-look-at-the-function">Enough English, lets take a look at the function:</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">probPlotNorm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">){</span><span class="w">

  </span><span class="c1">#get mean and standard deviation from values
</span><span class="w">  </span><span class="n">mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">
  </span><span class="n">msd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#get quantiles of normal dist with mean = mt and sd = msd
</span><span class="w">  </span><span class="n">probs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ppoints</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="w">
  </span><span class="n">quantNorm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">probs</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mt</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msd</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#draw reps*length(values) random values from an normal with mt and msd
</span><span class="w">  </span><span class="n">rvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="o">*</span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mt</span><span class="p">,</span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msd</span><span class="p">)</span><span class="w">
  </span><span class="c1">#store in a matrix with reps number of columns and length(values) number of rows
</span><span class="w">  </span><span class="n">normMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rvalues</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">),</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
  </span><span class="c1">#sort within each row
</span><span class="w">  </span><span class="n">sortedMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">normMat</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">)</span><span class="w">
  </span><span class="c1">#get the min and max for each row 
</span><span class="w">  </span><span class="n">rangeMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">sortedMat</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#make an empty plot with the correct dimensions
</span><span class="w">  </span><span class="n">xxlab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="w"> </span><span class="s2">"Quanatiles of Gaussian, with mean of "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mt</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s2">"\nand standard deviation of "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">msd</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">yylab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="w"> </span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="s2">" random draws from Gaussian,\nand some data"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#adjust plot margins
</span><span class="w">  </span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
  
  </span><span class="n">plot</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">normMat</span><span class="p">[</span><span class="m">1</span><span class="p">,]),</span><span class="w"> </span><span class="n">type</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">normMat</span><span class="p">)[</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">normMat</span><span class="p">)[</span><span class="m">2</span><span class="p">]),</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="w"> </span><span class="n">xxlab</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yylab</span><span class="p">)</span><span class="w">
  </span><span class="c1">#make the polygoon. notice the concatenation of the x axis twice, second time reversed. notice this too for the y axis.
</span><span class="w">  </span><span class="n">polygon</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">)),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="n">rangeMat</span><span class="p">[</span><span class="m">1</span><span class="p">,],</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">rangeMat</span><span class="p">[</span><span class="m">2</span><span class="p">,])),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"grey80"</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#plot the ranked data over the polygon
</span><span class="w">  </span><span class="n">lines</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">values</span><span class="p">),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"blue"</span><span class="p">)</span><span class="w">
  
  </span><span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"data"</span><span class="p">,</span><span class="s2">"simulation range"</span><span class="p">),</span><span class="w"> </span><span class="n">lty</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grey80"</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#reset plot margins
</span><span class="w">  </span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="m">1.1</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#return quantiles of normal dist with estimated parameters from data
</span><span class="w">  </span><span class="nf">return</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">quantNorm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">quantNorm</span><span class="p">))</span><span class="w">

  </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Example of calling the function</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sim.n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim.n</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="c1">#data &lt;- rexp(sim.n, rate = 1/10)
</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-3-1.png" alt="plot of chunk unnamed-chunk-3" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">probPlotNorm</span><span class="p">(</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-3-2.png" alt="plot of chunk unnamed-chunk-3" /></p>

<p>As mentioned above, this plot shows many random draws from a normal distribution compared to the quantiles from the normal distribution with the mean and standard deviation estimated from the data. The relationship between the quantiles and the data (data is the input, which could be residuals, or any set of values you expect to be drawn from a normal distribution) is shown as the blue line. The grey shape in the background is a summary of the random draws. I’m realizing this blog post has had little to do with the polygon function so far –  the grey shape was made using polygon. For each quantile value, I saved the minimum and maximum ranked values from the random draws. This is a quick and dirty summary that doesn’t account for the density of points at each quantile value – perhaps another blog post in the future. So, like the basic qqnorm function, we see the general pattern of the ranked data points compared to the quantiles of a normal distribution, but we also we the size of the departures we might expect to see given finite sample sizes. From this plot, we don’t get a great sense of how much non linearity we should be comfortable with, but using the ranges as boundaries is still quite informative about how much departure from the one-to-one line we can expect – in general. This is best demonstrated by intentionally providing data that is not normally distributed, and is instead, lets say, normal but bi-modal:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sim.n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim.n</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sim.n</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">50</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">example</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">probPlotNorm</span><span class="p">(</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-4-2.png" alt="plot of chunk unnamed-chunk-4" /></p>

<p>To see how much this observed bi-modal distribution departs from the normal distribution we expect, it’s more effective to see the differences between the minimum and maximum expected values at each quantile (the range), versus where the data lands on each quantile. This in a sense flattens the plot and emphasizes where the data is not between the min and max, and where there is curvature in the departures:</p>

<p>The supplemental plot function</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">probPlotNorm_supp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">){</span><span class="w">

  </span><span class="c1">#get mean and standard deviation from values
</span><span class="w">  </span><span class="n">mt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">
  </span><span class="n">msd</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#get quantiles of normal dist with mean = mt and sd = msd
</span><span class="w">  </span><span class="n">probs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ppoints</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="w">
  </span><span class="n">quantNorm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">probs</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mt</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msd</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#draw reps*length(values) random values from an normal with mt and msd
</span><span class="w">  </span><span class="n">rvalues</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rnorm</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="o">*</span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">),</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mt</span><span class="p">,</span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">msd</span><span class="p">)</span><span class="w">
  </span><span class="n">normMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="n">rvalues</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reps</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">values</span><span class="p">),</span><span class="w"> </span><span class="n">byrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
  </span><span class="n">sortedMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">normMat</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">)</span><span class="w">
  </span><span class="n">rangeMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">sortedMat</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w">
  
  
  </span><span class="n">svals</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="w">
</span><span class="c1">#difference between minimum simulated values at each quantile and the data values at each quantile
</span><span class="w">  </span><span class="n">lowrange</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rangeMat</span><span class="p">[</span><span class="m">1</span><span class="p">,]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">svals</span><span class="w">
  </span><span class="c1">#difference between maxiumum simulated values at each quantile and the data values at each quantile
</span><span class="w">  </span><span class="n">highrange</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rangeMat</span><span class="p">[</span><span class="m">2</span><span class="p">,]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">svals</span><span class="w">
  
  </span><span class="c1">#plot size range for y axis
</span><span class="w">  </span><span class="n">ptrng</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">lowrange</span><span class="p">,</span><span class="w"> </span><span class="n">highrange</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#x and y labels
</span><span class="w">  </span><span class="n">xxlab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="w"> </span><span class="s2">"Quanatiles of Gaussian, with mean of "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mt</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="s2">"\nand standard deviation of "</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">msd</span><span class="p">,</span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
  </span><span class="n">yylab</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="w"> </span><span class="s2">"Diff. between data and min at each quantile,\nand diff. between data and max at each quantile"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
  
  
  </span><span class="c1">#change plot margins
</span><span class="w">  </span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
  
  </span><span class="c1">#plot
</span><span class="w">  </span><span class="n">plot</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">lowrange</span><span class="p">),</span><span class="w"> </span><span class="n">lowrange</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"n"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">ptrng</span><span class="p">),</span><span class="w"> </span><span class="n">xlim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yylab</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="o">=</span><span class="n">xxlab</span><span class="p">)</span><span class="w">
 
  </span><span class="n">polygon</span><span class="p">(</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">quantNorm</span><span class="p">)),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="w"> </span><span class="n">lowrange</span><span class="p">,</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">highrange</span><span class="p">)),</span><span class="w"> </span><span class="n">lwd</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span><span class="w">
  </span><span class="n">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"cyan"</span><span class="p">)</span><span class="w">
  
  </span><span class="c1">#reset plot margins
</span><span class="w">  </span><span class="n">par</span><span class="p">(</span><span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">2</span><span class="p">)</span><span class="o">*</span><span class="m">1.1</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Calling the supplemental plot (same data as before)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">probPlotNorm_supp</span><span class="p">(</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="n">reps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="figure/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>We see some clear non-linear patterns in the data that extend well beyond the expected range of the random draws. This is still not a quantitative test, but it gives (me at least) a much better sense of when and by how much a set a values that are truly drawn from a normal distribution (or any distribution for which the parameters are readily estimated) can depart from the expected pattern by chance alone. Sounds a little more statistical at least eh?</p>
